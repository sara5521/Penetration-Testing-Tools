# üîß WMAP - Web Application Vulnerability Scanner

Comprehensive automated web application vulnerability scanner integrated within the Metasploit Framework

**Location in Framework:** `web-pentesting/vulnerability-assessment/wmap.md`

---

## üéØ What is WMAP?

WMAP (Web Mapper) is an integrated web application vulnerability scanner within the Metasploit Framework that provides comprehensive automated testing capabilities for web applications. WMAP combines the power of Metasploit's extensive auxiliary module library with structured web application assessment methodologies.

**Key Capabilities:**
- **Automated web crawling** and site mapping
- **Vulnerability detection** using 39+ specialized modules  
- **Target management** and organization
- **Integration** with Metasploit exploitation modules
- **Comprehensive reporting** of security findings
- **SSL/TLS testing** capabilities
- **Database integration** for result storage

WMAP was developed as part of the Metasploit Framework to provide penetration testers with a comprehensive tool for web application security assessment, offering both automated scanning and seamless integration with exploitation modules.

---

## üì¶ Installation and Setup

WMAP comes pre-installed with the Metasploit Framework on Kali Linux. No additional installation is required.

### Prerequisites
- Metasploit Framework installed
- Target web application accessible over HTTP/HTTPS
- Network connectivity to the target
- Proper network interface configuration

### Initial Setup Steps

#### Step 1: Network Interface Discovery
```bash
# Identify network configuration and target subnet
ifconfig
```

**Expected Lab Output:**
```
eth0: flags=4163<UP,BROADCAST,RUNNING,MULTICAST> mtu 1500
     inet 10.1.1.5  netmask 255.255.255.0  broadcast 10.1.1.255
     ether 02:42:0a:01:01:05  txqueuelen 0  (Ethernet)

eth1: flags=4163<UP,BROADCAST,RUNNING,MULTICAST> mtu 1500  
     inet 192.157.89.2  netmask 255.255.255.0  broadcast 192.157.89.255
     ether 02:42:c0:9d:59:02  txqueuelen 0  (Ethernet)
```

**Analysis:** Kali Linux IP is `192.157.89.2`, target IP will be `192.157.89.3`

#### Step 2: Start Metasploit Framework
```bash
# Launch Metasploit console
msfconsole
```

#### Step 3: Load and Verify WMAP
```bash
# Load WMAP plugin
msf5 > load wmap
```

**Expected Output:**
```
.-.-.-.-.-.-.-.-.-.-.-.-.-.-.
[WMAP 1.5.1] === et [ ] metasploit.com 2012
[*] Successfully loaded plugin: wmap
msf5 >
```

---

## üîß Basic Usage and Syntax

### Essential WMAP Workflow
```bash
# 1. Load WMAP plugin
load wmap

# 2. Add target site
wmap_sites -a <target_ip>

# 3. Add specific target URL
wmap_targets -t <target_url>

# 4. Verify configuration
wmap_sites -l
wmap_targets -l

# 5. Run test scan (dry run)
wmap_run -t

# 6. Execute full scan
wmap_run -e
```

### Core WMAP Commands Structure
- **Site Management:** `wmap_sites` - Manage target sites
- **Target Management:** `wmap_targets` - Configure specific targets
- **Scan Execution:** `wmap_run` - Execute vulnerability scans
- **Result Management:** `wmap_vulns` - View scan results

---

## ‚öôÔ∏è Command Line Options

### Site Management Commands
| Command | Description | Example |
|---------|-------------|---------|
| `wmap_sites -a <IP>` | Add target site | `wmap_sites -a 192.157.89.3` |
| `wmap_sites -l` | List all sites | `wmap_sites -l` |
| `wmap_sites -d <id>` | Delete site by ID | `wmap_sites -d 0` |
| `wmap_sites -c` | Clear all sites | `wmap_sites -c` |

### Target Management Commands  
| Command | Description | Example |
|---------|-------------|---------|
| `wmap_targets -t <URL>` | Add HTTP target | `wmap_targets -t http://192.157.89.3` |
| `wmap_targets -t <URL>` | Add HTTPS target | `wmap_targets -t https://target.com` |
| `wmap_targets -l` | List all targets | `wmap_targets -l` |
| `wmap_targets -d <id>` | Delete target | `wmap_targets -d 0` |
| `wmap_targets -c` | Clear all targets | `wmap_targets -c` |

### Scanning Commands
| Command | Description | Usage |
|---------|-------------|-------|
| `wmap_run -t` | Test run (show modules) | Dry run without execution |
| `wmap_run -e` | Execute all modules | Full comprehensive scan |
| `wmap_run -m <module>` | Run specific module | Targeted testing |
| `wmap_run -p` | Show scan progress | Monitor active scans |

---

## üß™ Real Lab Examples

### Lab: Web Application Vulnerability Scanning with WMAP

**Scenario:** Target IP `192.157.89.3` running Apache web server on port 80

#### Phase 1: Environment Preparation

**Step 1: Identify Target Network**
```bash
root@attackdefense:~# ifconfig
eth0: flags=4163<UP,BROADCAST,RUNNING,MULTICAST> mtu 1500
    inet 10.1.1.5 netmask 255.255.255.0 broadcast 10.1.1.255
    ether 02:42:0a:01:01:05 txqueuelen 0 (Ethernet)
    RX packets 155 bytes 15323 (14.9 KiB)
    RX errors 0 dropped 0 overruns 0 frame 0
    TX packets 131 bytes 315914 (308.5 KiB)
    TX errors 0 dropped 0 overruns 0 carrier 0 collisions 0

eth1: flags=4163<UP,BROADCAST,RUNNING,MULTICAST> mtu 1500
    inet 192.157.89.2 netmask 255.255.255.0 broadcast 192.157.89.255
    ether 02:42:c0:9d:59:02 txqueuelen 0 (Ethernet)
    RX packets 0 bytes 0 (0.0 B)
    RX errors 0 dropped 0 overruns 0 frame 0
    TX packets 0 bytes 0 (0.0 B)
    TX errors 0 dropped 0 overruns 0 carrier 0 collisions 0
```
**Analysis:** Kali Linux IP is `192.157.89.2`, target will be `192.157.89.3`

**Step 2: Start Metasploit and Load WMAP**
```bash
# Start Metasploit Framework
root@attackdefense:~# msfconsole

# Load WMAP plugin
msf5 > load wmap
.-.-.-.-.-.-.-.-.-.-.-.-.-.-.
[WMAP 1.5.1] === et [ ] metasploit.com 2012
[*] Successfully loaded plugin: wmap
msf5 >
```

#### Phase 2: Target Configuration

**Step 3: Configure Target Site and URL**
```bash
# Add target site to WMAP database
msf5 > wmap_sites -a 192.157.89.3

# Add specific target URL
msf5 > wmap_targets -t http://192.157.89.3
```

**Step 4: Verify Configuration**
```bash
# List available sites
msf5 > wmap_sites -l
[*] Available sites
================

Id  Host          Vhost         Port  Proto  # Pages  # Forms
--  ----          -----         ----  -----  -------  -------
0   192.157.89.3  192.157.89.3  80    http   0        0

# List defined targets
msf5 > wmap_targets -l
[*] Defined targets
================

Id  Vhost         Host          Port  SSL   Path
--  -----         ----          ----  ---   ----
0   192.157.89.3  192.157.89.3  80    false /
```

#### Phase 3: Scan Execution

**Step 5: Test Run (Module Discovery)**
```bash
msf5 > wmap_run -t
[*] Testing target:
[*]     Site: 192.157.89.3 (192.157.89.3)
[*]     Port: 80 SSL: false
================================================================
[*] Testing started. 2021-11-15 23:13:50 +0000
[*] Loading wmap modules...

[*] 39 wmap enabled modules loaded.
[*]
=[ SSL testing ]=
================================================================
[*] Target is not SSL. SSL modules disabled.
[*]

=[ Web Server testing ]=
================================================================
[*] Module auxiliary/scanner/http/http_version
[*] Module auxiliary/scanner/http/open_proxy
[*] Module auxiliary/admin/http/tomcat_administration
[*] Module auxiliary/admin/http/tomcat_utf8_traversal
[*] Module auxiliary/scanner/http/drupal_views_user_enum
[*] Module auxiliary/scanner/http/frontpage_login
[*] Module auxiliary/scanner/http/host_header_injection
[*] Module auxiliary/scanner/http/options
[*] Module auxiliary/scanner/http/robots_txt
[*] Module auxiliary/scanner/http/scraper
[*] Module auxiliary/scanner/http/svn_scanner
[*] Module auxiliary/scanner/http/trace
[*] Module auxiliary/scanner/http/vhost_scanner
[*] Module auxiliary/scanner/http/webdav_internal_ip
[*] Module auxiliary/scanner/http/webdav_scanner
[*] Module auxiliary/scanner/http/webdav_website_content
```

**Step 6: Execute Comprehensive Scan**
```bash
msf5 > wmap_run -e
[*] Using ALL wmap enabled modules.
[-] NO WMAP NODES DEFINED. Executing local modules
[*] Testing target:
[*]     Site: 192.157.89.3 (192.157.89.3)
[*]     Port: 80 SSL: false
================================================================
[*] Testing started. 2021-11-15 23:16:50 +0000
[*]
=[ SSL testing ]=
================================================================
[*] Target is not SSL. SSL modules disabled.
[*]
=[ Web Server testing ]=
================================================================
[*] Module auxiliary/scanner/http/http_version
[+] 192.157.89.3:80 Apache/2.4.18 (Ubuntu)

[*] Module auxiliary/scanner/http/open_proxy
[*] Module auxiliary/admin/http/tomcat_administration
[*] Module auxiliary/admin/http/tomcat_utf8_traversal
[*] Attempting to connect to 192.157.89.3:80
[+] No File(s) found

[*] Module auxiliary/scanner/http/drupal_views_user_enum
```

#### Phase 4: Results Analysis

**Key Findings from Scan:**
- **Web Server:** Apache/2.4.18 (Ubuntu)
- **Port:** 80 (HTTP)
- **SSL Status:** Not enabled (SSL modules disabled)
- **Connection Status:** Successfully connected to target
- **Security Assessment:** 39 modules executed for comprehensive testing

**Discovered Information:**
- Target confirmed responsive on port 80
- Apache version 2.4.18 identified
- Ubuntu operating system detected
- No immediate file access vulnerabilities found
- Complete module coverage achieved

---

## üéØ eJPT Exam Focus

### Essential WMAP Skills for eJPT Certification

#### 1. Core WMAP Operations
```bash
# Complete WMAP workflow for eJPT
msfconsole
msf5 > load wmap
msf5 > wmap_sites -a <target_ip>
msf5 > wmap_targets -t http://<target_ip>
msf5 > wmap_run -t    # Review modules
msf5 > wmap_run -e    # Execute scan
```

#### 2. Target Configuration Skills
- Proper site and target setup using network reconnaissance
- Understanding HTTP vs HTTPS targeting
- Path-specific scanning for web directories
- Verification of configuration before scanning

#### 3. Scan Interpretation and Analysis
- **Web Server Identification:** Version and OS detection
- **Module Output Analysis:** Understanding success/failure indicators
- **Vulnerability Recognition:** Identifying potential security issues
- **SSL/TLS Assessment:** Protocol security evaluation

#### 4. Integration with Metasploit Ecosystem
- Using WMAP results to guide exploitation module selection
- Database integration for evidence storage
- Transitioning from reconnaissance to exploitation
- Documentation of findings for reporting

### Common eJPT Exam Scenarios
- **Web Application Assessment:** Complete vulnerability scanning workflow
- **Information Gathering:** Server fingerprinting and technology identification
- **Attack Vector Identification:** Using scan results to plan exploitation
- **Evidence Documentation:** Proper recording of security findings

### Critical eJPT Commands
```bash
# Network reconnaissance
ifconfig
nmap -sC -sV <target>

# WMAP scanning
load wmap
wmap_sites -a <target>
wmap_targets -t http://<target>
wmap_run -e

# Results analysis
services
vulns
```

---

## ‚ö†Ô∏è Common Issues & Troubleshooting

### Issue 1: WMAP Plugin Loading Failure
```bash
# Problem: WMAP fails to load
[-] Failed to load plugin: wmap

# Solution: Verify Metasploit installation
msfconsole --version
msfdb init
```

### Issue 2: No WMAP Modules Available
```bash
# Problem: No modules loaded
[*] 0 wmap enabled modules loaded.

# Solution: Update Metasploit framework
apt update && apt upgrade metasploit-framework
msfconsole
reload_all
```

### Issue 3: Target Connection Issues
```bash
# Problem: Cannot reach target
[-] Connection refused

# Solution: Verify network connectivity
ping <target_ip>
nmap -p 80,443 <target_ip>
telnet <target_ip> 80
```

### Issue 4: SSL Certificate Problems
```bash
# Problem: SSL handshake failures
[-] SSL handshake failed

# Solution: Use SSL-specific options
wmap_targets -t https://<target> --ssl-verify-none
```

### Issue 5: "NO WMAP NODES DEFINED" Warning
```bash
# Problem: Warning message during execution
[-] NO WMAP NODES DEFINED. Executing local modules

# Explanation: This is normal behavior
# WMAP falls back to local modules when no crawl data exists
# Scan will still execute successfully
```

---

## üîó Integration with Other Tools

### Integration with Nmap (Pre-WMAP Reconnaissance)
```bash
# Use Nmap for initial port and service discovery
nmap -sS -sV -p- <target_ip>
nmap --script http-enum <target_ip>

# Then proceed with WMAP for detailed web application testing
msfconsole
load wmap
wmap_sites -a <target_ip>
wmap_run -e
```

### Integration with Burp Suite (Manual Verification)
1. **WMAP for automated scanning:** Initial vulnerability discovery
2. **Burp Suite for manual testing:** Detailed exploitation and validation
3. **Combined approach:** Automated + manual for comprehensive assessment

### Integration with Nikto (Complementary Scanning)
```bash
# WMAP provides Metasploit-integrated scanning
nikto -h <target_ip> -p 80

# Combine results for comprehensive web server assessment
# WMAP: Metasploit module integration
# Nikto: Specialized web server vulnerability testing
```

### Database Integration and Result Management
```bash
# WMAP results automatically stored in Metasploit database
db_status
hosts
services -p 80,443
vulns

# Export comprehensive results
db_export -f xml /path/to/wmap_results.xml
db_export -f html /path/to/wmap_report.html
```

### Transition to Exploitation Modules
```bash
# Based on WMAP findings, search for relevant exploits
search type:exploit webapp apache 2.4
search cve:2017 apache
use exploit/multi/http/specific_vulnerability
set RHOSTS <target_ip>
exploit
```

---

## üìù Documentation and Reporting

### Comprehensive Evidence Collection

#### 1. Command Documentation
```bash
# Document complete WMAP workflow
echo "WMAP Scan Commands:" > wmap_evidence.txt
echo "==================" >> wmap_evidence.txt
echo "ifconfig" >> wmap_evidence.txt
echo "msfconsole" >> wmap_evidence.txt
echo "load wmap" >> wmap_evidence.txt
echo "wmap_sites -a 192.157.89.3" >> wmap_evidence.txt
echo "wmap_targets -t http://192.157.89.3" >> wmap_evidence.txt
echo "wmap_run -e" >> wmap_evidence.txt
```

#### 2. Scan Results Documentation
**Key Information to Document:**
- **Target Configuration:**
  - IP addresses: 192.157.89.3
  - Ports and protocols: 80/HTTP
  - Web server version: Apache/2.4.18 (Ubuntu)

- **WMAP Module Results:**
  - Total modules executed: 39
  - Successful identifications: Server version, OS type
  - Security findings: SSL status, file access results
  - Connection status: Successful target communication

- **Vulnerability Assessment:**
  - Server fingerprinting results
  - Protocol security evaluation
  - Administrative interface testing
  - Content discovery results

#### 3. Professional Report Structure
```
1. Executive Summary
   - Scope: Web application vulnerability assessment
   - Tools: WMAP within Metasploit Framework
   - Key findings: Apache/2.4.18 server identified

2. Technical Methodology  
   - Network reconnaissance with ifconfig
   - Target configuration in WMAP
   - Comprehensive module execution
   - Results analysis and interpretation

3. WMAP Scan Results
   - Site configuration: 192.157.89.3:80
   - Module execution: 39 modules successful
   - Server identification: Apache/2.4.18 (Ubuntu)
   - Security assessment: SSL disabled, standard HTTP

4. Risk Assessment
   - Information disclosure: Server version exposed
   - Protocol security: Unencrypted HTTP traffic
   - Administrative access: No immediate admin interfaces found

5. Recommendations
   - Enable HTTPS with proper SSL/TLS configuration
   - Server banner hardening to prevent information disclosure
   - Regular security assessments and patch management
   - Implement proper access controls and monitoring

6. Technical Appendices
   - Complete WMAP command output
   - Module execution logs
   - Network configuration details
   - Raw scan data and timestamps
```

### Evidence Quality Standards
- **Screenshots:** Capture key command outputs and results
- **Raw Output:** Preserve complete module execution logs  
- **Timestamps:** Document scan execution times and dates
- **Network Context:** Include network configuration and targeting rationale
- **Reproducibility:** Provide sufficient detail for scan replication
