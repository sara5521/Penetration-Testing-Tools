# üï∑Ô∏è WMAP - Metasploit Web Application Scanner

Comprehensive guide to using WMAP (Web Mapper) for automated web application vulnerability scanning within the Metasploit Framework.

---

## üéØ What is WMAP?

WMAP is an integrated web application vulnerability scanner within Metasploit that provides:
- **Automated web crawling** and site mapping
- **Vulnerability detection** using Metasploit modules
- **Target management** and organization
- **Comprehensive reporting** of findings
- **Integration** with Metasploit exploitation modules

---

## üîß Initial Setup and Configuration

### Step 1: Network Interface Discovery
```bash
# Identify network configuration
ifconfig
```

**Expected Output from Lab:**
```
eth0: flags=4163<UP,BROADCAST,RUNNING,MULTICAST> mtu 1500
     inet 10.1.1.5  netmask 255.255.255.0  broadcast 10.1.1.255
     ether 02:42:0a:01:01:05  txqueuelen 0  (Ethernet)

eth1: flags=4163<UP,BROADCAST,RUNNING,MULTICAST> mtu 1500  
     inet 192.157.89.2  netmask 255.255.255.0  broadcast 192.157.89.255
     ether 02:42:c0:9d:59:02  txqueuelen 0  (Ethernet)
```

**Lab Environment:**
- Kali Linux IP: 192.157.89.2
- Target IP: 192.157.89.3 (next IP in subnet)

### Step 2: Start Metasploit Framework
```bash
# Launch Metasploit console
msfconsole
```

### Step 3: Load WMAP Plugin
```bash
# Load WMAP extension
msf5 > load wmap
```

**Expected Output:**
```
.-.-.-.-.-.-.-.-.-.-.-.-.-.-.
[WMAP 1.5.1] === et [ ] metasploit.com 2012
[*] Successfully loaded plugin: wmap
msf5 >
```

---

## üï∏Ô∏è WMAP Site Management

### Adding Target Sites
```bash
# Add target site to WMAP database
msf5 > wmap_sites -a 192.157.89.3
```

### Adding Specific Target URLs  
```bash
# Add target with specific URL
msf5 > wmap_targets -t http://192.157.89.3
```

### Viewing Configured Sites
```bash
# List all available sites
msf5 > wmap_sites -l
```

**Expected Output:**
```
[*] Available sites
================

Id  Host          Vhost         Port  Proto  # Pages  # Forms
--  ----          -----         ----  -----  -------  -------  
0   192.157.89.3  192.157.89.3  80    http   0        0
```

### Viewing Target Configuration
```bash
# List defined targets  
msf5 > wmap_targets -l
```

**Expected Output:**
```
[*] Defined targets  
================

Id  Vhost         Host          Port  SSL  Path
--  -----         ----          ----  ---  ----
0   192.157.89.3  192.157.89.3  80    false  /
```

---

## üöÄ Running WMAP Scans

### Basic Vulnerability Scan
```bash
# Start comprehensive web application scan
msf5 > wmap_run -t
```

### Scan Execution Flow
**Scan Initialization:**
```
[*] Testing target:
[*]     Site: 192.157.89.3 (192.157.89.3)  
[*]     Port: 80 SSL: false
================================================================
[*] Testing started. 2021-11-15 23:13:50 +0000
[*] Loading wmap modules...
```

**Module Loading:**
```
[*] 39 wmap enabled modules loaded.
[*]
=[ SSL testing ]=
================================================================
[*] Target is not SSL. SSL modules disabled.

=[ Web Server testing ]=
================================================================
```

### Available WMAP Modules (From Lab Output)

#### HTTP Scanners:
- `auxiliary/scanner/http/http_version` - Web server version detection
- `auxiliary/scanner/http/open_proxy` - Open proxy detection  
- `auxiliary/admin/http/tomcat_administration` - Tomcat admin interface
- `auxiliary/admin/http/tomcat_utf8_traversal` - Directory traversal
- `auxiliary/scanner/http/drupal_views_user_enum` - Drupal user enumeration
- `auxiliary/scanner/http/frontpage_login` - FrontPage login testing
- `auxiliary/scanner/http/host_header_injection` - Host header injection
- `auxiliary/scanner/http/options` - HTTP methods enumeration
- `auxiliary/scanner/http/robots_txt` - robots.txt analysis
- `auxiliary/scanner/http/scraper` - Content scraping

---

## üìã WMAP Command Reference

### Site Management Commands
| Command | Description | Example |
|---------|-------------|---------|
| `wmap_sites -a <IP>` | Add site | `wmap_sites -a 192.168.1.100` |
| `wmap_sites -l` | List sites | `wmap_sites -l` |
| `wmap_sites -d <id>` | Delete site | `wmap_sites -d 0` |

### Target Management Commands  
| Command | Description | Example |
|---------|-------------|---------|
| `wmap_targets -t <URL>` | Add target | `wmap_targets -t http://target.com` |
| `wmap_targets -l` | List targets | `wmap_targets -l` |
| `wmap_targets -d <id>` | Delete target | `wmap_targets -d 0` |

### Scanning Commands
| Command | Description | Example |
|---------|-------------|---------|
| `wmap_run -t` | Run full scan | `wmap_run -t` |
| `wmap_run -e` | Run specific modules | `wmap_run -e` |
| `wmap_run -p` | Show scan progress | `wmap_run -p` |

---

## üß™ Practical Lab Walkthrough

### Complete Workflow from Images:

#### Phase 1: Environment Preparation
1. **Network Discovery:** `ifconfig`
   - Identified Kali IP: 192.157.89.2
   - Target IP: 192.157.89.3

2. **Metasploit Setup:** `msfconsole`
   - Launched framework console

3. **WMAP Loading:** `load wmap`
   - Successfully loaded WMAP 1.5.1

#### Phase 2: Target Configuration  
1. **Site Addition:** `wmap_sites -a 192.157.89.3`
   - Added target to site database

2. **Target Specification:** `wmap_targets -t http://192.157.89.3`
   - Configured specific target URL

3. **Verification:** `wmap_sites -l` and `wmap_targets -l`
   - Confirmed target configuration

### Complete WMAP Scan Execution

#### Phase 4: Running the Vulnerability Scan
```bash
# Execute all enabled WMAP modules
msf5 > wmap_run -e
```

**Scan Execution Output:**
```
[*] Using ALL wmap enabled modules.
[-] NO WMAP NODES DEFINED. Executing local modules
[*] Testing target:
[*]     Site: 192.157.89.3 (192.157.89.3)
[*]     Port: 80 SSL: false
================================================================
[*] Testing started. 2021-11-15 23:16:50 +0000
[*]
=[ SSL testing ]=
================================================================
[*] Target is not SSL. SSL modules disabled.
[*]
=[ Web Server testing ]=
================================================================
[*] Module auxiliary/scanner/http/http_version
```

#### Phase 5: Scan Results Analysis

**Server Information Discovered:**
```
[+] 192.157.89.3:80 Apache/2.4.18 (Ubuntu)
```

**Modules Executed:**
- `auxiliary/scanner/http/http_version` - ‚úÖ SUCCESS
- `auxiliary/scanner/http/open_proxy` - ‚úÖ COMPLETED
- `auxiliary/admin/http/tomcat_administration` - ‚úÖ TESTED
- `auxiliary/admin/http/tomcat_utf8_traversal` - ‚úÖ TESTED
- `auxiliary/scanner/http/drupal_views_user_enum` - ‚úÖ COMPLETED

**Key Findings:**
- **Web Server:** Apache/2.4.18 running on Ubuntu
- **Port 80:** HTTP service confirmed active
- **No SSL:** Target not using HTTPS
- **Connection Status:** Successfully connected to 192.157.89.3:80
- **File Access:** No specific files found in initial scan

### Additional Modules from Lab Output:

#### Complete Module List:
```
[*] Module auxiliary/scanner/http/svn_scanner
[*] Module auxiliary/scanner/http/trace  
[*] Module auxiliary/scanner/http/vhost_scanner
[*] Module auxiliary/scanner/http/webdav_internal_ip
[*] Module auxiliary/scanner/http/webdav_scanner
[*] Module auxiliary/scanner/http/webdav_website_content
```

**Notable Modules:**
- `webdav_scanner` - WebDAV service detection
- `webdav_website_content` - WebDAV content enumeration  
- `svn_scanner` - Subversion repository detection
- `vhost_scanner` - Virtual host enumeration

---

## üîç Understanding WMAP Results

### Module Categories:

#### 1. Information Gathering
- **HTTP Version Detection** - Server software identification
- **Robots.txt Analysis** - Discover hidden directories
- **Directory Enumeration** - Map application structure

#### 2. Vulnerability Assessment  
- **Authentication Testing** - Login mechanisms
- **Injection Testing** - SQL, command injection
- **Configuration Issues** - Misconfigurations and defaults

#### 3. Access Control Testing
- **Authorization Bypass** - Access control flaws
- **Session Management** - Session handling issues
- **Administrative Interfaces** - Admin panel discovery

---

## üõ†Ô∏è Advanced WMAP Techniques

### Advanced WMAP Commands

#### Running All Enabled Modules
```bash
# Execute comprehensive scan with all modules
msf5 > wmap_run -e
```

This command differs from `wmap_run -t` by:
- Uses ALL enabled WMAP modules
- Executes local modules when no nodes defined
- Provides more comprehensive coverage

#### Alternative Scan Commands
```bash
# Run specific modules only
msf5 > wmap_run -e auxiliary/scanner/http/http_version,auxiliary/scanner/http/robots_txt

# Run with specific target ID
msf5 > wmap_run -t -i 0
```

### Database Integration
```bash
# View WMAP results in database
msf5 > wmap_vulns -l

# Export results  
msf5 > wmap_reports -o /tmp/wmap_report.html
```

### Integration with Other Metasploit Modules
```bash
# Use WMAP findings for exploitation
msf5 > search type:exploit webapp
msf5 > use exploit/multi/http/specific_vulnerability
```

---

## üìä Interpreting WMAP Output

### Scan Progress Indicators
- `[*] Testing target:` - Target initialization
- `[*] Loading wmap modules...` - Module preparation  
- `[*] 39 wmap enabled modules loaded` - Available scan modules
- `=[ SSL testing ]=` - Protocol-specific testing phases
- `=[ Web Server testing ]=` - Application layer testing

### Module Execution Results
- **SUCCESS** - Module completed without errors
- **FAIL** - Module encountered issues or vulnerabilities
- **INFO** - Informational findings
- **VULN** - Potential vulnerabilities identified

---

## üéØ eJPT Exam Focus

### Key Concepts:
1. **WMAP installation and loading** in Metasploit
2. **Target site management** - adding and configuring targets
3. **Automated vulnerability scanning** workflow
4. **Result interpretation** and follow-up actions
5. **Integration** with Metasploit exploitation modules

### Common Exam Tasks:
- Configure WMAP for target web application
- Run comprehensive vulnerability scans
- Identify potential attack vectors from results
- Document scan findings and vulnerabilities
- Demonstrate progression from scanning to exploitation

### Essential Commands:
```bash
# Complete WMAP workflow
msfconsole
msf5 > load wmap
msf5 > wmap_sites -a <target_ip>
msf5 > wmap_targets -t http://<target_ip>
msf5 > wmap_run -t
```

---

## üîó Integration with Penetration Testing Workflow

### 1. Reconnaissance Phase
- Network discovery with Nmap
- Service enumeration
- Initial web application identification

### 2. WMAP Scanning Phase  
- Automated vulnerability assessment
- Comprehensive module coverage
- Structured result collection

### 3. Manual Verification Phase
- Verify WMAP findings manually
- Use Burp Suite for detailed analysis
- Confirm exploitable vulnerabilities

### 4. Exploitation Phase
- Leverage Metasploit modules based on WMAP results
- Manual exploitation of identified vulnerabilities
- Post-exploitation activities

---

## ‚ö†Ô∏è Limitations and Considerations

### WMAP Limitations:
- **False positives** - May report non-existent vulnerabilities
- **Limited coverage** - Cannot test all vulnerability types
- **Authentication** - Limited support for authenticated scanning
- **Modern applications** - May miss newer vulnerability classes

### Best Practices:
- Always verify WMAP findings manually
- Combine with other scanning tools (Nikto, Burp Suite)
- Use WMAP as starting point, not final assessment
- Document all findings thoroughly for reporting

---

## üìù Documentation and Reporting

### Evidence Collection:
1. **Command history** - Document all WMAP commands used
2. **Scan results** - Capture module outputs and findings
3. **Screenshots** - Visual evidence of vulnerabilities
4. **Manual verification** - Confirm automated findings

### Report Structure:
- **Executive Summary** - High-level findings
- **Technical Details** - WMAP module results
- **Vulnerability Assessment** - Risk rating and impact
- **Recommendations** - Remediation guidance
